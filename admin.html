<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Form Submissions | Syntra Refining</title>

  <script src="https://cdn.tailwindcss.com"></script>

  

    <link rel="stylesheet" href="/syntra-unified.css?v=203">

    <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500;700&family=Oswald:wght@400;500;600;700&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            syntra: {
              base: '#F8FAFC',
              surface: '#FFFFFF',
              text: '#0F172A',
              midnight: '#0B1120',
              accent: '#FFD700',
              amber: '#D97706',
              tech: '#0891B2',
              muted: '#64748B',
              border: '#E2E8F0',
            }
          },
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
            head: ['Oswald', 'sans-serif'],
            mono: ['JetBrains Mono', 'monospace'],
          },
        }
      }
    }
  </script>

  <style>
    .logo-container { cursor: pointer; }
    .logo-outer { transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), border-color 0.3s; }
    .logo-inner { transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), background-color 0.3s; }
    .logo-container:hover .logo-outer { transform: rotate(0deg); border-color: #D97706; }
  </style>
</head>
<body class="bg-syntra-base text-syntra-text font-sans antialiased">

  <!-- NAV -->
  <nav class="bg-white border-b border-syntra-border">
    <div class="container mx-auto px-6 h-20 flex items-center justify-between">
      <a href="index.html" class="logo-container flex items-center gap-3 group">
        <div class="logo-outer w-10 h-10 border-[3px] border-syntra-accent transform rotate-45 flex items-center justify-center">
          <div class="logo-inner w-4 h-4 bg-syntra-accent transform -rotate-45"></div>
        </div>
        <div class="leading-none">
          <div class="font-head font-bold text-2xl tracking-tight text-syntra-text">SYNTRA</div>
          <div class="font-head text-[0.65rem] font-bold text-syntra-amber tracking-[0.2em] uppercase mt-1">REFINING CORP</div>
        </div>
      </a>
      <div class="text-xs font-mono uppercase text-syntra-muted">Form Submissions</div>
    </div>
  </nav>

  <!-- MAIN CONTENT -->
  <div class="container mx-auto px-6 py-12">
    <!-- Header with Stats -->
    <div class="mb-8">
      <h1 class="font-head text-4xl font-bold uppercase mb-4">Form Submissions</h1>
      <div class="grid md:grid-cols-4 gap-4">
        <div class="bg-white border border-syntra-border rounded-lg p-4">
          <p class="text-xs font-mono text-syntra-muted uppercase mb-1">Total</p>
          <p id="totalCount" class="font-head text-3xl font-bold">0</p>
        </div>
        <div class="bg-white border border-syntra-border rounded-lg p-4">
          <p class="text-xs font-mono text-syntra-muted uppercase mb-1">Unread</p>
          <p id="unreadCount" class="font-head text-3xl font-bold text-syntra-amber">0</p>
        </div>
        <div class="bg-white border border-syntra-border rounded-lg p-4">
          <p class="text-xs font-mono text-syntra-muted uppercase mb-1">Partner Inquiries</p>
          <p id="partnerCount" class="font-head text-3xl font-bold">0</p>
        </div>
        <div class="bg-white border border-syntra-border rounded-lg p-4">
          <p class="text-xs font-mono text-syntra-muted uppercase mb-1">Investor Inquiries</p>
          <p id="investorCount" class="font-head text-3xl font-bold">0</p>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="bg-white border border-syntra-border rounded-lg p-4 mb-6">
      <div class="flex flex-wrap gap-4 items-center">
        <label class="flex items-center gap-2">
          <span class="text-sm font-mono uppercase text-syntra-muted">Filter:</span>
        </label>
        <select id="filterType" class="bg-slate-50 border border-slate-200 rounded px-4 py-2 text-sm font-mono" onchange="loadSubmissions()">
          <option value="all">All Types</option>
          <option value="partner_inquiry">Partner Inquiries</option>
          <option value="investor_inquiry">Investor Inquiries</option>
        </select>
        <select id="filterStatus" class="bg-slate-50 border border-slate-200 rounded px-4 py-2 text-sm font-mono" onchange="loadSubmissions()">
          <option value="all">All Status</option>
          <option value="unread">Unread Only</option>
          <option value="read">Read Only</option>
        </select>
        <button onclick="loadSubmissions()" class="ml-auto px-4 py-2 bg-syntra-text text-white text-sm font-mono uppercase rounded hover:bg-black transition-colors">
          Refresh
        </button>
      </div>
    </div>

    <!-- Submissions List -->
    <div id="submissionsList" class="space-y-4">
      <div class="text-center py-12 text-slate-500">
        <p class="font-mono text-sm">Loading submissions...</p>
      </div>
    </div>
  </div>

  <!-- Supabase JS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/js/syntra-config.js?v=202"></script>
  <script src="/js/supabase-client.js?v=202"></script>

  <script>
    async function loadSubmissions() {
      const filterType = document.getElementById('filterType').value;
      const filterStatus = document.getElementById('filterStatus').value;

      try {
        let query = supabase
          .from('form_submissions')
          .select('*')
          .order('created_at', { ascending: false });

        if (filterType !== 'all') {
          query = query.eq('form_type', filterType);
        }

        if (filterStatus === 'unread') {
          query = query.eq('read_status', false);
        } else if (filterStatus === 'read') {
          query = query.eq('read_status', true);
        }

        const { data, error } = await query;

        if (error) throw error;

        displaySubmissions(data);
        updateStats(data);
      } catch (error) {
        console.error('Error loading submissions:', error);
        document.getElementById('submissionsList').innerHTML = `
          <div class="bg-red-50 border border-red-200 rounded-lg p-6 text-center">
            <p class="text-red-600 font-bold mb-2">Error Loading Submissions</p>
            <p class="text-sm text-red-500">Please make sure you're authenticated and have the proper permissions.</p>
          </div>
        `;
      }
    }

    function updateStats(data) {
      const total = data.length;
      const unread = data.filter(s => !s.read_status).length;
      const partner = data.filter(s => s.form_type === 'partner_inquiry').length;
      const investor = data.filter(s => s.form_type === 'investor_inquiry').length;

      document.getElementById('totalCount').textContent = total;
      document.getElementById('unreadCount').textContent = unread;
      document.getElementById('partnerCount').textContent = partner;
      document.getElementById('investorCount').textContent = investor;
    }

    function displaySubmissions(submissions) {
      const container = document.getElementById('submissionsList');

      if (submissions.length === 0) {
        container.innerHTML = `
          <div class="text-center py-12 text-slate-500">
            <p class="font-mono text-sm">No submissions found.</p>
          </div>
        `;
        return;
      }

      container.innerHTML = submissions.map(sub => `
        <div class="bg-white border ${sub.read_status ? 'border-syntra-border' : 'border-syntra-accent border-2'} rounded-lg p-6 ${sub.read_status ? '' : 'bg-yellow-50/30'}">
          <div class="flex items-start justify-between mb-4">
            <div class="flex items-start gap-4 flex-1">
              ${sub.read_status ? '' : '<div class="w-2 h-2 bg-syntra-accent rounded-full mt-2"></div>'}
              <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                  <h3 class="font-head text-xl font-bold uppercase">
                    ${sub.first_name} ${sub.last_name || ''}
                  </h3>
                  <span class="px-2 py-1 bg-slate-100 rounded text-xs font-mono uppercase">
                    ${sub.form_type === 'partner_inquiry' ? 'Partner' : sub.form_type === 'investor_inquiry' ? 'Investor' : 'Career Application'}
                  </span>
                  ${sub.reference_id ? `<span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs font-mono">${sub.reference_id}</span>` : ''}
                  ${sub.read_status ? '' : '<span class="px-2 py-1 bg-syntra-accent/20 text-syntra-amber rounded text-xs font-mono uppercase font-bold">NEW</span>'}
                </div>
                <div class="grid md:grid-cols-2 gap-x-6 gap-y-2 text-sm mb-3">
                  <div>
                    <span class="font-mono text-syntra-muted text-xs">Email:</span>
                    <a href="mailto:${sub.email}" class="text-syntra-tech hover:underline ml-2">${sub.email}</a>
                  </div>
                  ${sub.phone ? `
                  <div>
                    <span class="font-mono text-syntra-muted text-xs">Phone:</span>
                    <a href="tel:${sub.phone}" class="text-syntra-tech hover:underline ml-2">${sub.phone}</a>
                  </div>
                  ` : ''}
                  ${sub.form_type !== 'career_application' ? `
                  <div>
                    <span class="font-mono text-syntra-muted text-xs">Organization:</span>
                    <span class="ml-2 font-semibold">${sub.organization}</span>
                  </div>
                  ` : ''}
                  <div>
                    <span class="font-mono text-syntra-muted text-xs">${sub.form_type === 'career_application' ? 'Position' : 'Interest'}:</span>
                    <span class="ml-2">${sub.interest_type}</span>
                  </div>
                  <div>
                    <span class="font-mono text-syntra-muted text-xs">Date:</span>
                    <span class="ml-2">${new Date(sub.created_at).toLocaleString()}</span>
                  </div>
                  ${sub.additional_data?.linkedin ? `
                  <div>
                    <span class="font-mono text-syntra-muted text-xs">LinkedIn:</span>
                    <a href="${sub.additional_data.linkedin}" target="_blank" class="text-syntra-tech hover:underline ml-2">View Profile</a>
                  </div>
                  ` : ''}
                  ${sub.additional_data?.resume_url ? `
                  <div>
                    <span class="font-mono text-syntra-muted text-xs">Resume:</span>
                    <a href="${sub.additional_data.resume_url}" target="_blank" class="text-syntra-tech hover:underline ml-2 inline-flex items-center gap-1">
                      Download Resume
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"></path>
                      </svg>
                    </a>
                  </div>
                  ` : ''}
                </div>
                ${sub.message ? `
                  <div class="bg-slate-50 rounded p-3 text-sm">
                    <p class="font-mono text-syntra-muted text-xs mb-1">${sub.form_type === 'career_application' ? 'Cover Letter:' : 'Message:'}</p>
                    <p class="whitespace-pre-wrap">${sub.message}</p>
                  </div>
                ` : ''}
              </div>
            </div>
            <div class="flex gap-2 ml-4">
              ${sub.read_status
                ? `<button onclick="markAsUnread('${sub.id}')" class="px-3 py-1 bg-slate-100 text-slate-700 text-xs font-mono uppercase rounded hover:bg-slate-200 transition-colors">Mark Unread</button>`
                : `<button onclick="markAsRead('${sub.id}')" class="px-3 py-1 bg-syntra-accent text-syntra-text text-xs font-mono uppercase rounded hover:bg-yellow-400 transition-colors">Mark Read</button>`
              }
            </div>
          </div>
        </div>
      `).join('');
    }

    async function markAsRead(id) {
      try {
        const { error } = await supabase
          .from('form_submissions')
          .update({ read_status: true })
          .eq('id', id);

        if (error) throw error;

        loadSubmissions();
      } catch (error) {
        console.error('Error updating submission:', error);
        alert('Failed to update submission status.');
      }
    }

    async function markAsUnread(id) {
      try {
        const { error } = await supabase
          .from('form_submissions')
          .update({ read_status: false })
          .eq('id', id);

        if (error) throw error;

        loadSubmissions();
      } catch (error) {
        console.error('Error updating submission:', error);
        alert('Failed to update submission status.');
      }
    }

    loadSubmissions();
  </script>
  <script src="/js/syntra-contact-modal.js?v=203"></script>
</body>
</html>
